<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="icon" type="image/png" href="./assets/images/blog.in.png">
    <title>ðŸš€ Search Blog.in</title>

    <link rel="stylesheet" href="css/navbar.css">
    <link rel="stylesheet" href="css/footer.css">
    <style>
        /* ===== MODERN SEARCH UI STYLES ===== */
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --primary-light: #8b5cf6;
            --secondary: #f59e0b;
            --accent: #10b981;
            --text: #1e293b;
            --text-light: #64748b;
            --bg: #f8fafc;
            --bg-card: #ffffff;
            --border: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --radius: 12px;
            --transition: all 0.3s ease;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }

        .search-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }

        .search-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .search-header h1 {
            font-size: clamp(2rem, 5vw, 3.5rem);
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
        }

        .search-header p {
            font-size: 1.2rem;
            color: var(--text-light);
            max-width: 600px;
            margin: 0 auto;
        }

        .search-box {
            background: var(--bg-card);
            border-radius: var(--radius);
            padding: 2rem;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
            border: 1px solid var(--border);
        }

        .search-form {
            margin-bottom: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.75rem;
            font-weight: 600;
            color: var(--text);
            font-size: 1.1rem;
        }

        .search-input-container {
            position: relative;
            margin-bottom: 1rem;
        }

        .search-input {
            width: 100%;
            padding: 1.2rem 1.5rem 1.2rem 3rem;
            font-size: 1.1rem;
            border: 2px solid var(--border);
            border-radius: var(--radius);
            background: var(--bg);
            transition: var(--transition);
            color: var(--text);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-light);
        }

        .search-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .search-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: var(--radius);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .search-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .clear-btn {
            background: var(--text-light);
            color: white;
            border: none;
            padding: 1rem 1.5rem;
            border-radius: var(--radius);
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
        }

        .clear-btn:hover {
            background: #475569;
            transform: translateY(-2px);
        }

        .search-stats {
            font-size: 0.95rem;
            color: var(--text-light);
            padding: 0.75rem 0;
            font-weight: 500;
        }

        .search-filters {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .filter-btn {
            background: var(--bg);
            color: var(--text);
            border: 1px solid var(--border);
            padding: 0.75rem 1.5rem;
            border-radius: 50px;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.95rem;
            font-weight: 500;
        }

        .filter-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .filter-btn:hover:not(.active) {
            background: #f1f5f9;
            border-color: var(--primary-light);
        }

        .results-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .result-card {
            background: var(--bg-card);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 1px solid var(--border);
            position: relative;
        }

        .result-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-light);
        }

        .result-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .result-card:hover::before {
            transform: scaleX(1);
        }

        .card-header {
            padding: 1.5rem 1.5rem 1rem;
            border-bottom: 1px solid var(--border);
        }

        .card-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            line-height: 1.4;
        }

        .card-title a {
            color: var(--text);
            text-decoration: none;
            transition: var(--transition);
        }

        .card-title a:hover {
            color: var(--primary);
        }

        .card-meta {
            display: flex;
            gap: 1rem;
            font-size: 0.85rem;
            color: var(--text-light);
        }

        .card-body {
            padding: 1rem 1.5rem;
        }

        .card-excerpt {
            color: var(--text-light);
            line-height: 1.6;
        }

        .highlight {
            background: linear-gradient(120deg, #fef3c7, #fde68a);
            padding: 0.1rem 0.3rem;
            border-radius: 4px;
            font-weight: 600;
            color: #92400e;
        }

        .card-footer {
            padding: 1rem 1.5rem;
            background: #f8fafc;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-badges {
            display: flex;
            gap: 0.5rem;
        }

        .badge {
            padding: 0.3rem 0.75rem;
            border-radius: 50px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .badge-primary {
            background: var(--primary);
            color: white;
        }

        .badge-secondary {
            background: var(--secondary);
            color: white;
        }

        .badge-accent {
            background: var(--accent);
            color: white;
        }

        .card-actions {
            display: flex;
            gap: 0.5rem;
        }

        .action-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            border: 1px solid var(--border);
            color: var(--text-light);
            cursor: pointer;
            transition: var(--transition);
        }

        .action-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* User Card Styles */
        .user-card {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
        }

        .user-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 1.5rem;
            flex-shrink: 0;
            border: 3px solid #fff;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .user-info {
            flex: 1;
        }

        .user-name {
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 0.25rem;
        }

        .user-username {
            color: var(--text-light);
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .user-bio {
            color: var(--text-light);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .user-stats {
            display: flex;
            gap: 1rem;
            margin-top: 0.75rem;
        }

        .user-stat {
            text-align: center;
        }

        .user-stat-value {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--primary);
        }

        .user-stat-label {
            font-size: 0.75rem;
            color: var(--text-light);
        }

        /* Status Messages */
        .no-results {
            grid-column: 1 / -1;
            text-align: center;
            padding: 3rem 2rem;
            background: var(--bg-card);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }

        .no-results i {
            font-size: 3rem;
            color: var(--text-light);
            margin-bottom: 1rem;
        }

        .no-results h3 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            color: var(--text);
        }

        .no-results p {
            color: var(--text-light);
            max-width: 500px;
            margin: 0 auto;
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            grid-column: 1 / -1;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(99, 102, 241, 0.2);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .info-notice {
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            border: 1px solid #bae6fd;
            border-radius: 12px;
            padding: 1.25rem;
            margin: 1.5rem 0;
            color: #0369a1;
            font-weight: 500;
        }

        .success-notice {
            background: linear-gradient(135deg, #f0fdf4, #dcfce7);
            border: 1px solid #bbf7d0;
            border-radius: 12px;
            padding: 1.25rem;
            margin: 1.5rem 0;
            color: #166534;
            font-weight: 500;
        }

        .error-notice {
            background: linear-gradient(135deg, #fef2f2, #fee2e2);
            border: 1px solid #fecaca;
            border-radius: 12px;
            padding: 1.25rem;
            margin: 1.5rem 0;
            color: #dc2626;
            font-weight: 500;
        }

        /* Profile Modal Styles */
        .profile-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(8px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .profile-modal.active {
            display: flex;
        }

        .profile-modal-content {
            background: white;
            padding: 2rem;
            border-radius: 20px;
            max-width: 500px;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease;
            border: 1px solid var(--border);
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .profile-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #f8fafc;
        }

        .profile-modal-header h3 {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1e293b;
            margin: 0;
        }

        .profile-modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #64748b;
            transition: var(--transition);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .profile-modal-close:hover {
            background: #f8fafc;
            color: #1e293b;
            transform: rotate(90deg);
        }

        /* Enhanced User Avatar for Modal */
        .profile-modal .user-avatar {
            width: 100px;
            height: 100px;
            font-size: 2.5rem;
            border: 4px solid #fff;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .search-container {
                padding: 1rem;
            }

            .search-box {
                padding: 1.5rem;
            }

            .results-container {
                grid-template-columns: 1fr;
            }

            .search-actions {
                flex-direction: column;
                align-items: stretch;
            }

            .search-btn,
            .clear-btn {
                width: 100%;
                justify-content: center;
            }

            .user-card {
                flex-direction: column;
                text-align: center;
            }

            .user-avatar {
                align-self: center;
            }

            .user-stats {
                justify-content: center;
            }

            .profile-modal-content {
                padding: 1.5rem;
                margin: 1rem;
            }
        }

        @media (max-width: 480px) {
            .search-header h1 {
                font-size: 2rem;
            }

            .search-header p {
                font-size: 1rem;
            }

            .search-box {
                padding: 1rem;
            }

            .search-input {
                padding: 1rem 1rem 1rem 2.5rem;
                font-size: 1rem;
            }

            .search-filters {
                gap: 0.5rem;
            }

            .filter-btn {
                padding: 0.75rem 1rem;
                font-size: 0.9rem;
                flex: 1;
                min-width: 0;
            }
        }
    </style>
</head>

<body>
    <div id="navbar-placeholder"></div>

    <main class="search-container" role="main">
        <div class="search-header">
            <h1>Discover Amazing Content</h1>
            <p>Search through thousands of posts, users, and blogs to find exactly what you need.</p>
        </div>

        <div class="search-box">
            <form id="searchForm" class="search-form" role="search" action="./search.html" method="get">
                <div class="form-group">
                    <label for="query">Find posts, users, and blogs</label>
                    <div class="search-input-container">
                        <i class="fas fa-search search-icon"></i>
                        <input id="query" name="q" type="search" class="search-input"
                            placeholder="Search posts, users, profiles, blogs..." autocomplete="off"
                            aria-describedby="searchHelp" />
                    </div>
                </div>

                <div class="search-actions">
                    <button id="searchBtn" class="search-btn" type="submit">
                        <i class="fas fa-search"></i>
                        Search
                    </button>
                    <button id="clearBtn" class="clear-btn" type="button" title="Clear">
                        <i class="fas fa-times"></i>
                        Clear
                    </button>
                </div>

                <div id="searchHelp" class="search-stats" aria-live="polite">
                    Enter a search term to find posts, users, and blogs
                </div>
            </form>

            <div class="search-filters">
                <button class="filter-btn active" data-filter="all">All</button>
                <button class="filter-btn" data-filter="posts">Posts</button>
                <button class="filter-btn" data-filter="users">Users</button>
                <button class="filter-btn" data-filter="blogs">Blogs</button>
            </div>
        </div>

        <div id="firebaseStatus" class="info-notice">
            <i class="fas fa-sync-alt fa-spin"></i> Loading search functionality...
        </div>

        <div id="results" class="results-container" aria-live="polite">
            <!-- Results will be dynamically inserted here -->
        </div>
    </main>

    <!-- Profile Preview Modal -->
    <div id="profileModal" class="profile-modal">
        <div class="profile-modal-content">
            <div class="profile-modal-header">
                <h3>User Profile</h3>
                <button class="profile-modal-close">&times;</button>
            </div>
            <div id="profileModalContent">
                <!-- Profile content will be loaded here -->
            </div>
        </div>
    </div>

    <div id="footer-placeholder"></div>

    <script type="module">
        // DOM elements
        const queryInput = document.getElementById('query');
        const resultsEl = document.getElementById('results');
        const clearBtn = document.getElementById('clearBtn');
        const searchBtn = document.getElementById('searchBtn');
        const searchHelp = document.getElementById('searchHelp');
        const firebaseStatus = document.getElementById('firebaseStatus');
        const filterBtns = document.querySelectorAll('.filter-btn');
        const profileModal = document.getElementById('profileModal');
        const profileModalContent = document.getElementById('profileModalContent');
        const profileModalClose = document.querySelector('.profile-modal-close');

        // Search state
        let postsIndex = [];
        let usersIndex = [];
        let lastQuery = '';
        let currentFilter = 'all';
        let firebaseInitialized = false;

        // Initialize Firebase and load data
        async function initializeFirebase() {
            try {
                updateFirebaseStatus('<i class="fas fa-sync-alt fa-spin"></i> Loading demo data...', 'loading');

                // Simulate loading delay
                await new Promise(resolve => setTimeout(resolve, 1500));

                // Load demo data (replace with actual Firebase code when available)
                await loadDemoData();

                firebaseInitialized = true;
                updateFirebaseStatus(`<i class="fas fa-check-circle"></i> Successfully loaded ${postsIndex.length} posts and ${usersIndex.length} users`, 'success');
                updateUIState('ready');

                // If there's a query in URL, perform search
                const params = new URLSearchParams(location.search);
                const q = params.get('q') || '';
                if (q) {
                    queryInput.value = q;
                    doSearch(q);
                }

            } catch (error) {
                console.error('Initialization error:', error);
                updateFirebaseStatus(`<i class="fas fa-exclamation-circle"></i> Error loading data: ${error.message}`, 'error');
                updateUIState('error', 'Failed to load data. Please check console for details.');
            }
        }

        // Load demo data for testing
        function loadDemoData() {
            // Demo posts data
            postsIndex = [
                {
                    id: 'post1',
                    type: 'post',
                    title: 'Getting Started with Modern JavaScript',
                    url: '#post1',
                    excerpt: 'Learn the fundamentals of modern JavaScript and how to use ES6+ features in your projects.',
                    tags: ['JavaScript', 'Web Development', 'Programming'],
                    date: '2023-10-15',
                    content: 'Modern JavaScript has evolved significantly over the years. With the introduction of ES6 and subsequent versions, developers now have access to powerful features that make coding more efficient and readable.',
                    author: 'Alex Johnson',
                    authorId: 'user1'
                },
                {
                    id: 'post2',
                    type: 'post',
                    title: 'The Complete Guide to CSS Grid',
                    url: '#post2',
                    excerpt: 'Master CSS Grid layout with this comprehensive guide covering all the essential concepts and techniques.',
                    tags: ['CSS', 'Web Design', 'Layout'],
                    date: '2023-09-22',
                    content: 'CSS Grid Layout is a powerful tool for creating two-dimensional layouts on the web. It allows you to design complex responsive layouts with ease.',
                    author: 'Sarah Williams',
                    authorId: 'user2'
                },
                {
                    id: 'post3',
                    type: 'post',
                    title: 'Building Scalable React Applications',
                    url: '#post3',
                    excerpt: 'Best practices and patterns for building large-scale React applications that are maintainable and performant.',
                    tags: ['React', 'JavaScript', 'Frontend'],
                    date: '2023-11-05',
                    content: 'When building React applications at scale, it\'s important to follow established patterns and best practices to ensure your codebase remains maintainable.',
                    author: 'Mike Chen',
                    authorId: 'user3'
                },
                {
                    id: 'post4',
                    type: 'post',
                    title: 'Introduction to Firebase Authentication',
                    url: '#post4',
                    excerpt: 'Learn how to implement secure authentication in your web applications using Firebase.',
                    tags: ['Firebase', 'Authentication', 'Security'],
                    date: '2023-08-30',
                    content: 'Firebase Authentication provides backend services to authenticate users to your app. It supports authentication using passwords, phone numbers, and popular identity providers.',
                    author: 'Alex Johnson',
                    authorId: 'user1'
                }
            ];

            // Demo users data with followers/following counts
            usersIndex = [
                {
                    id: 'user1',
                    type: 'user',
                    name: 'Alex Johnson',
                    username: 'alexj',
                    email: 'alex@example.com',
                    bio: 'Full-stack developer passionate about JavaScript and modern web technologies.',
                    createdAt: '2022-03-15',
                    updatedAt: '2023-10-20',
                    uid: 'user1',
                    followersCount: 42,
                    followingCount: 28,
                    profileImage: ''
                },
                {
                    id: 'user2',
                    type: 'user',
                    name: 'Sarah Williams',
                    username: 'sarahw',
                    email: 'sarah@example.com',
                    bio: 'UI/UX designer and frontend developer focused on creating beautiful user experiences.',
                    createdAt: '2021-11-08',
                    updatedAt: '2023-09-25',
                    uid: 'user2',
                    followersCount: 67,
                    followingCount: 35,
                    profileImage: ''
                },
                {
                    id: 'user3',
                    type: 'user',
                    name: 'Mike Chen',
                    username: 'mikec',
                    email: 'mike@example.com',
                    bio: 'Senior software engineer specializing in React and Node.js applications.',
                    createdAt: '2020-07-22',
                    updatedAt: '2023-11-10',
                    uid: 'user3',
                    followersCount: 89,
                    followingCount: 42,
                    profileImage: ''
                },
                {
                    id: 'user4',
                    type: 'user',
                    name: 'Emma Davis',
                    username: 'emmad',
                    email: 'emma@example.com',
                    bio: 'Technical writer and documentation specialist with a focus on developer tools.',
                    createdAt: '2023-01-12',
                    updatedAt: '2023-10-15',
                    uid: 'user4',
                    followersCount: 23,
                    followingCount: 18,
                    profileImage: ''
                }
            ];
        }

        // Format date from various possible formats
        function formatDate(dateValue) {
            if (!dateValue) return '';

            try {
                // If it's a Firestore timestamp
                if (dateValue.toDate) {
                    return dateValue.toDate().toLocaleDateString();
                }

                // If it's a string or number
                const date = new Date(dateValue);
                if (!isNaN(date.getTime())) {
                    return date.toLocaleDateString();
                }

                return String(dateValue);
            } catch (e) {
                return String(dateValue);
            }
        }

        // Show user profile in modal
        function showUserProfile(user) {
            profileModalContent.innerHTML = `
                <div class="user-card">
                    <div class="user-avatar" style="${user.profileImage ? `background-image: url('${escapeHtml(user.profileImage)}'); background-size: cover;` : ''}">
                        ${user.profileImage ? '' : (user.name ? user.name.charAt(0).toUpperCase() : 'U')}
                    </div>
                    <div class="user-info">
                        <div class="user-name">${escapeHtml(user.name || 'Unknown User')}</div>
                        <div class="user-username">@${escapeHtml(user.username || '')}</div>
                        <div class="user-bio">${escapeHtml(user.bio || 'No bio available')}</div>
                        
                        <div class="user-stats">
                            <div class="user-stat">
                                <div class="user-stat-value">${user.followersCount || 0}</div>
                                <div class="user-stat-label">Followers</div>
                            </div>
                            <div class="user-stat">
                                <div class="user-stat-value">${user.followingCount || 0}</div>
                                <div class="user-stat-label">Following</div>
                            </div>
                        </div>
                        
                        <div class="card-badges" style="margin-top: 1rem;">
                            <span class="badge badge-primary">User Profile</span>
                            <span>Joined: ${escapeHtml(user.createdAt || 'Unknown')}</span>
                        </div>
                        <div style="margin-top: 1rem;">
                            <h4>Contact</h4>
                            <p>Email: ${escapeHtml(user.email || 'Not provided')}</p>
                        </div>
                    </div>
                </div>
            `;
            profileModal.classList.add('active');
        }

        // Show post details in modal
        function showPostDetails(post) {
            profileModalContent.innerHTML = `
                <div>
                    <h3>${escapeHtml(post.title || 'Untitled Post')}</h3>
                    <div class="card-meta">
                        <time><i class="far fa-calendar"></i> ${escapeHtml(post.date || 'Unknown date')}</time>
                        ${post.author ? `<span><i class="fas fa-user"></i> by ${escapeHtml(post.author)}</span>` : ''}
                    </div>
                    <div class="card-excerpt" style="margin-top: 1rem;">
                        ${escapeHtml(post.content || post.excerpt || 'No content available')}
                    </div>
                    ${Array.isArray(post.tags) && post.tags.length > 0 ? `
                        <div class="card-badges" style="margin-top: 1rem;">
                            ${post.tags.map(tag => `<span class="badge badge-secondary">${escapeHtml(tag)}</span>`).join('')}
                        </div>
                    ` : ''}
                </div>
            `;
            profileModal.classList.add('active');
        }

        // Update Firebase connection status
        function updateFirebaseStatus(message, type = 'info') {
            const className = type === 'error' ? 'error-notice' :
                type === 'success' ? 'success-notice' :
                    type === 'loading' ? 'info-notice' : 'info-notice';

            firebaseStatus.innerHTML = message;
            firebaseStatus.className = className;
        }

        // Update UI based on state
        function updateUIState(state, message = '') {
            switch (state) {
                case 'loading':
                    searchBtn.disabled = true;
                    searchHelp.textContent = 'Loading search index...';
                    break;
                case 'ready':
                    searchBtn.disabled = false;
                    const query = queryInput.value.trim();
                    if (!query) {
                        searchHelp.textContent = `Ready to search ${postsIndex.length} posts and ${usersIndex.length} users`;
                    }
                    break;
                case 'error':
                    searchBtn.disabled = false;
                    searchHelp.textContent = message;
                    break;
            }
        }

        // Highlight search terms in text
        function highlight(text, terms) {
            if (!terms.length) return escapeHtml(text);

            let highlighted = escapeHtml(text);
            terms.forEach(term => {
                const regex = new RegExp(`(${escapeRegExp(term)})`, 'gi');
                highlighted = highlighted.replace(regex, '<mark class="highlight">$1</mark>');
            });
            return highlighted;
        }

        // Escape HTML to prevent XSS
        function escapeHtml(s) {
            if (typeof s !== 'string') return '';
            return s.replace(/[&<>"']/g, c =>
                ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' }[c])
            );
        }

        // Escape regex special characters
        function escapeRegExp(s) {
            return s.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }

        // Perform search on the indexes
        function search(q) {
            q = (q || '').trim();
            if (!q) return { posts: [], users: [] };

            const terms = q.toLowerCase().split(/\s+/).filter(Boolean);
            const termSet = new Set(terms);

            // Search posts
            const postResults = postsIndex
                .map(item => {
                    const searchText = [
                        item.title || '',
                        item.excerpt || '',
                        item.content || '',
                        Array.isArray(item.tags) ? item.tags.join(' ') : '',
                        item.author || ''
                    ].join(' ').toLowerCase();

                    let score = 0;
                    for (const term of termSet) {
                        if (item.title && item.title.toLowerCase().includes(term)) {
                            score += 5;
                        }

                        if (Array.isArray(item.tags) && item.tags.some(tag =>
                            tag.toLowerCase().includes(term))) {
                            score += 3;
                        }

                        const contentMatches = (item.content || '').toLowerCase().split(term).length - 1;
                        score += contentMatches * 0.1;

                        const excerptMatches = (item.excerpt || '').toLowerCase().split(term).length - 1;
                        score += excerptMatches * 0.5;

                        if (item.author && item.author.toLowerCase().includes(term)) {
                            score += 2;
                        }
                    }

                    return { item, score };
                })
                .filter(r => r.score > 0)
                .sort((a, b) => b.score - a.score)
                .map(r => r.item);

            // Search users
            const userResults = usersIndex
                .map(item => {
                    const searchText = [
                        item.name || '',
                        item.username || '',
                        item.bio || '',
                        item.email || ''
                    ].join(' ').toLowerCase();

                    let score = 0;
                    for (const term of termSet) {
                        if (item.name && item.name.toLowerCase().includes(term)) {
                            score += 5;
                        }

                        if (item.username && item.username.toLowerCase().includes(term)) {
                            score += 4;
                        }

                        if (item.bio && item.bio.toLowerCase().includes(term)) {
                            score += 3;
                        }

                        if (item.email && item.email.toLowerCase().includes(term)) {
                            score += 1;
                        }
                    }

                    return { item, score };
                })
                .filter(r => r.score > 0)
                .sort((a, b) => b.score - a.score)
                .map(r => r.item);

            return { posts: postResults, users: userResults };
        }

        // Render search results
        function render(results, q) {
            const terms = q ? q.toLowerCase().split(/\s+/).filter(Boolean) : [];
            const { posts, users } = results;

            let totalResults = 0;
            let filteredResults = [];

            // Filter results based on current filter
            if (currentFilter === 'all') {
                filteredResults = [
                    ...posts.map(item => ({ ...item, type: 'post' })),
                    ...users.map(item => ({ ...item, type: 'user' }))
                ];
                totalResults = posts.length + users.length;
            } else if (currentFilter === 'posts') {
                filteredResults = posts.map(item => ({ ...item, type: 'post' }));
                totalResults = posts.length;
            } else if (currentFilter === 'users') {
                filteredResults = users.map(item => ({ ...item, type: 'user' }));
                totalResults = users.length;
            }

            // Update search stats
            if (q) {
                let filterText = '';
                if (currentFilter === 'posts') filterText = ' in posts';
                if (currentFilter === 'users') filterText = ' in users';

                searchHelp.textContent = totalResults === 0 ?
                    `No results found for "${q}"${filterText}` :
                    `Found ${totalResults} result${totalResults !== 1 ? 's' : ''} for "${q}"${filterText}`;
            } else {
                if (firebaseInitialized) {
                    searchHelp.textContent = `Ready to search ${postsIndex.length} posts and ${usersIndex.length} users`;
                } else {
                    searchHelp.textContent = 'Loading search data...';
                }
            }

            // Render results
            if (!q) {
                resultsEl.innerHTML = `
                    <div class="no-results">
                        <i class="fas fa-search"></i>
                        <h3>Ready to Search</h3>
                        <p>Enter a query above to discover posts and users</p>
                    </div>
                `;
                return;
            }

            if (totalResults === 0) {
                resultsEl.innerHTML = `
                    <div class="no-results">
                        <i class="fas fa-search"></i>
                        <h3>No Results Found</h3>
                        <p>Try different keywords or browse all content</p>
                    </div>
                `;
                return;
            }

            resultsEl.innerHTML = '';

            for (const item of filteredResults) {
                const card = document.createElement('div');
                card.className = 'result-card';

                if (item.type === 'post') {
                    // Render post item
                    card.innerHTML = `
                        <div class="card-header">
                            <h3 class="card-title">
                                <a href="${escapeHtml(item.url || '#')}" class="profile-link" data-type="post" data-id="${item.id}">
                                    ${highlight(item.title || 'Untitled Post', terms)}
                                </a>
                            </h3>
                            <div class="card-meta">
                                ${item.date ? `<time><i class="far fa-calendar"></i> ${escapeHtml(item.date)}</time>` : ''}
                                ${item.author ? `<span><i class="fas fa-user"></i> ${escapeHtml(item.author)}</span>` : ''}
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="card-excerpt">
                                ${highlight(item.excerpt || '', terms)}
                            </div>
                        </div>
                        ${Array.isArray(item.tags) && item.tags.length > 0 ? `
                            <div class="card-footer">
                                <div class="card-badges">
                                    ${item.tags.slice(0, 3).map(tag => `<span class="badge badge-secondary">${escapeHtml(tag)}</span>`).join('')}
                                    ${item.tags.length > 3 ? `<span class="badge">+${item.tags.length - 3} more</span>` : ''}
                                </div>
                                <div class="card-actions">
                                    <button class="action-btn" title="Bookmark"><i class="far fa-bookmark"></i></button>
                                    <button class="action-btn" title="Share"><i class="fas fa-share-alt"></i></button>
                                </div>
                            </div>
                        ` : ''}
                    `;
                } else if (item.type === 'user') {
                    // Render user item with followers/following
                    card.innerHTML = `
                        <div class="card-header">
                            <div class="user-card">
                                <div class="user-avatar" style="${item.profileImage ? `background-image: url('${escapeHtml(item.profileImage)}'); background-size: cover;` : ''}">
                                    ${item.profileImage ? '' : (item.name ? item.name.charAt(0).toUpperCase() : 'U')}
                                </div>
                                <div class="user-info">
                                    <div class="user-name">
                                        <span class="profile-link" data-type="user" data-username="${item.username}">
                                            ${highlight(item.name || 'Unknown User', terms)}
                                        </span>
                                    </div>
                                    <div class="user-username">
                                        @${highlight(item.username, terms)}
                                    </div>
                                    <div class="user-bio">
                                        ${highlight(item.bio || '', terms)}
                                    </div>
                                    <div class="user-stats">
                                        <div class="user-stat">
                                            <div class="user-stat-value">${item.followersCount || 0}</div>
                                            <div class="user-stat-label">Followers</div>
                                        </div>
                                        <div class="user-stat">
                                            <div class="user-stat-value">${item.followingCount || 0}</div>
                                            <div class="user-stat-label">Following</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <div class="card-badges">
                                <span class="badge badge-primary">User</span>
                                <span>Joined ${escapeHtml(item.createdAt || '')}</span>
                            </div>
                            <div class="card-actions">
                                <button class="action-btn" title="Message"><i class="far fa-envelope"></i></button>
                                <button class="action-btn" title="Follow"><i class="fas fa-user-plus"></i></button>
                            </div>
                        </div>
                    `;
                }

                resultsEl.appendChild(card);
            }

            // Add click listeners to profile links
            document.querySelectorAll('.profile-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const type = link.dataset.type;
                    const id = link.dataset.id;
                    const username = link.dataset.username;

                    if (type === 'user') {
                        const user = usersIndex.find(u => u.username === username) ||
                            usersIndex.find(u => u.name === username);
                        if (user) {
                            showUserProfile(user);
                        }
                    } else if (type === 'post') {
                        const post = postsIndex.find(p => p.id === id);
                        if (post) {
                            showPostDetails(post);
                        }
                    }
                });
            });
        }

        // Debounce function to limit search frequency
        function debounce(fn, wait = 300) {
            let timeout;
            return (...args) => {
                clearTimeout(timeout);
                timeout = setTimeout(() => fn(...args), wait);
            };
        }

        // Perform search with debouncing
        const doSearch = debounce((q) => {
            if (q === lastQuery) return;

            lastQuery = q;

            // Show loading state
            if (q.trim()) {
                resultsEl.innerHTML = `
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                `;
            }

            setTimeout(() => {
                const results = search(q);
                render(results, q);
            }, 300);
        }, 200);

        // Event listeners
        queryInput.addEventListener('input', (e) => {
            const q = e.target.value;

            const u = new URL(location);
            if (q) {
                u.searchParams.set('q', q);
            } else {
                u.searchParams.delete('q');
            }
            history.replaceState({}, '', u);

            doSearch(q);
        });

        clearBtn.addEventListener('click', () => {
            queryInput.value = '';
            queryInput.focus();
            history.replaceState({}, '', location.pathname);
            render({ posts: [], users: [] }, '');
            lastQuery = '';
        });

        document.getElementById('searchForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const q = queryInput.value;
            doSearch(q);
        });

        // Filter button event listeners
        filterBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                filterBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentFilter = btn.dataset.filter;

                if (lastQuery) {
                    const results = search(lastQuery);
                    render(results, lastQuery);
                }
            });
        });

        // Profile modal event listeners
        profileModalClose.addEventListener('click', () => {
            profileModal.classList.remove('active');
        });

        profileModal.addEventListener('click', (e) => {
            if (e.target === profileModal) {
                profileModal.classList.remove('active');
            }
        });

        // Close modal with Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && profileModal.classList.contains('active')) {
                profileModal.classList.remove('active');
            }
        });

        // Initialize when page loads
        initializeFirebase();
    </script>
    <script type="module" src="./js/navbar.js"></script>
    <script type="module" src="./js/footer.js"></script>
</body>

</html>